<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum Home</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>
    <style>
        
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            color: #fff;
            background-color: #fff;
            font-weight: bold;

        }

        .top-section, .bottom-section {
            height: 8%;
            width: 100%;
            background-color: #16163f;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .top-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 equal columns */
            gap: 20px;
            align-items: stretch; /* This will make children items take full height */

        }

        .bottom-section {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 equal columns */
            align-items: stretch; /* This will make children items take full height */
            gap: 20px;  /* Optional: adds a gap between items for aesthetics */
        }

        .bottom-section a {
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
            color: #fff; /* Original text color */
            text-decoration: none; /* Remove underlines from links */
            height: 100%; /* Take full height */
            width: 100%; /* Full width to occupy the entire grid cell */
        }

        .bottom-section a:hover {
            background-color: #C2FE00;
            color: #16163F;
            text-decoration: none;
        }

        .middle-section {
            max-height: 70vh;  /* Changed from height to max-height */
            width: 100%;
            overflow-y: scroll;
            background-color: #f5f5f5; /* Light grey to visualize the section */
        }


        .search, .nav-item, .bottom-section > div {
            flex: 1;
            text-align: center;
        }
        .search, .nav {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .search input[type="text"] {
            color: #16163f; /* Using the text color you've defined earlier */
            background-color: #f5f5f5; /* Using the background color from the middle section for consistency */
            font-family: Arial, sans-serif; /* Your defined font */
            border: 2px solid #C2FE00; /* Using the hover color you used for the nav-item for consistency */
            padding: 5px 10px;
            border-radius: 5px;
            margin-right: 5px; /* Add this line to create space */
            font-weight: bold; /* Keeping consistent with your theme */
            width: 70%; /* Just an example to make the input wider, adjust as needed */
        }

        .search button {
            color: #16163F; 
            background-color: #C2FE00; /* Using the top section background color */
            font-family: Arial, sans-serif; /* Your defined font */
            border: 2px solid #C2FE00; /* Using the hover color you used for the nav-item for consistency */
            padding: 5px 15px; /* Giving it a bit more horizontal padding for a better look */
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold; /* Keeping consistent with your theme */
            transition: background-color 0.3s; /* Smooth transition for hover effect */
        }

        .nav {
            position: relative; /* Add this line */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .nav-item {
            display: flex; /* Using flex to center its content and take full height */
            align-items: center; /* Vertically center content */
            justify-content: center; /* Horizontally center content */
            transition: background-color 0.3s; 
            height: 100%; /* Take full height */
        }

        .nav-item:hover {
            background-color: #C2FE00;
            color: #16163F;
            text-decoration: none; /* Prevent the underlining on hover */
        }



        .dropdown {
            display: none;
            position: absolute;
            top: 100%; /* Positioned right under .nav-item */
            left: 0; /* Start from the left edge of .nav-item */
            width: 100%; /* Stretch across entire .nav-item */
            background-color: #16163F;
            color: #C2FE00;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }

        .dropdown a {
            color: #fff; /* Set this to white */
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown a:hover {
            background-color: #C2FE00;
            color: #16163F;
        }

        .nav-item:hover .dropdown {
            display: block;
            text-decoration: none; /* Prevent the underlining on hover */
        }

    </style>
<body>
    <!-- Top section -->
    <div class="top-section">
        <!-- Search section -->
        <div class="search">
            <input type="text" placeholder="Search...">
            <button>Search</button>
        </div>
        <!-- Navigation section -->
        <div class="nav">
            <div class="nav-item">Menu
                <div class="dropdown">
                    <a href="#">Astro Posts</a>
                    <a href="#">Latest Posts</a>
                    <a href="#">Popular Posts</a>
                    <a href="#">Expert Posts</a>
                </div>
            </div>
        </div>
    </div>

    <div class="middle-section" id="middle-content">
    <!-- This is where content will be loaded dynamically -->
    {% include 'core/partial_community_forum_forum_home.html' %}

</div>

    <!-- Bottom section -->
    <div class="bottom-section">
        <a href="javascript:void(0);" data-content="/community_forum_forum_home/" onclick="loadContent(this)">Home</a>
        <a href="javascript:void(0);" data-content="/community_forum_forum_groups/" onclick="loadContent(this)">Groups</a>
        <a href="javascript:void(0);" data-content="/community_forum_forum_post/" onclick="loadContent(this)">Post</a>
        <a href="javascript:void(0);" data-content="/community_forum_forum_alerts/" onclick="loadContent(this)">Alerts</a>
        <a href="javascript:void(0);" data-content="/community_forum_forum_account/" onclick="loadContent(this)">Account</a>
    </div>
 
    <script>
        $(document).ready(function() {
            const csrfToken = $('meta[name="csrf-token"]').attr('content');
    

            function showToast(message) {
                const existingToast = document.querySelector('.toast');
                if (existingToast) {
                    existingToast.remove(); // Remove any existing toast
                }
        
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.innerText = message;
        
                document.body.appendChild(toast);
        
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 3000); // 3 seconds.
            }
            const currentUser = {
                username: "{{ request.user.username }}"  // Set the currently logged in user's username
            }

        
            // For liking a post
            $(".like-button").on("click", function() {
                const post_id = $(this).attr("data-post-id");
                const btn = $(this);

                $.ajax({
                    url: `/like_post/${post_id}/`,
                    method: "POST",
                    data: {
                        csrfmiddlewaretoken: csrfToken
                    },
                    success: function(response) {
                        if (response.status == "liked") {
                            btn.text("Unlike");
                            btn.attr("data-liked", "true");
                        } else {
                            btn.text("Like");
                            btn.attr("data-liked", "false");
                        }


                    },
                    error: function(error) {
                        console.error("Error liking the post:", error);
                    }
                });
            });
    
            // For displaying the comment box
            $(".comment-button").on("click", function() {
                const post_id = $(this).attr("data-post-id");
                const commentSection = $(this).closest(".post-footer").siblings(`.comment-section[data-post-id="${post_id}"]`);
                commentSection.toggle();
            });
    
            // For submitting a comment
            $(".submit-comment").on("click", function() {
                const post_id = $(this).attr("data-post-id");
                const comment_content = $(this).siblings(".comment-text").val();
    
                if (comment_content.trim() !== "") {
                    const btn = $(this);

                    $.ajax({
                        url: `/add_comment/${post_id}/`,
                        method: "POST",
                        data: {
                            text: comment_content,
                            csrfmiddlewaretoken: csrfToken
                        },
                        success: function(response) {
                            if (response.status == "comment_added") {
                                btn.siblings(".comments-list").append(`
                                    <div class="comment">
                                        <span class="comment-author">{{ request.user.username }}</span>
                                        <span class="comment-content">${response.content}</span>
                                    </div>
                                `);
                                btn.siblings(".comment-text").val('');  // Clear the textarea
                            }
                        },
                        error: function(error) {
                            console.error("Error submitting the comment:", error);
                        }
                    });
                }
            });

            // For deleting a post
            $(".delete-button").on("click", function() {
                const post_id = $(this).attr("data-post-id");
                const postDiv = $(`.post[data-post-id="${post_id}"]`);
                const btn = $(this);

                $.ajax({
                    url: `/post/${post_id}/delete/`,
                    method: "POST",
                    data: {
                        csrfmiddlewaretoken: csrfToken
                    },
                    success: function(response) {
                        if (response.status == "post_deleted") {
                            postDiv.remove();  // Remove the post element from the DOM
                            showToast('Post was deleted successfully!');
                        } else {
                            showToast('Failed to delete the post!');
                        }
                    },
                    error: function(error) {
                        console.error("Error deleting the post:", error);
                    }
                });
            });

            // Handling the click on the "Edit post" button
            $(document).on("click", ".edit-post-button", function() {
                const parentPostDiv = $(this).closest('.post'); 
                parentPostDiv.find('.post-title, .post-description').hide();  // Hide original title and description
                parentPostDiv.find('.edit-post-title, .edit-post-description').show();  // Show edit inputs
                parentPostDiv.find('.save-post-button').show(); // Show the save button
            });



            // Handling the post edit form submission
            $(document).on("click", ".save-post-button", function() {
                const parentPostDiv = $(this).closest('.post');
                const postId = parentPostDiv.data("post-id");
                const titleInput = parentPostDiv.find('.edit-post-title');
                const descriptionInput = parentPostDiv.find('.edit-post-description');

                $.ajax({
                    url: `/post/${postId}/edit/`,
                    method: "POST",
                    data: {
                        title: titleInput.val(),
                        description: descriptionInput.val(),
                        csrfmiddlewaretoken: csrfToken
                    },
                    success: function(response) {
                        if (response.status === "post_edited") {
                            parentPostDiv.find('.post-title').text(response.title).show();
                            parentPostDiv.find('.post-description').text('Description: ' + response.description).show();
                            titleInput.add(descriptionInput).hide();  // Hide the edit inputs
                            parentPostDiv.find('.save-post-button').hide(); // Hide the save button
                        } else {
                            showToast("Failed to edit post.");
                        }
                    },
                    error: function(error) {
                        console.error("Error editing post:", error);
                    }
                });
            });

            // For deleting a comment
            $(document).on("click", ".delete-comment-button", function() {
                const comment_id = $(this).attr("data-comment-id");
                const parentCommentDiv = $(this).closest('.comment'); // Navigate to the parent comment div directly

                $.ajax({
                    url: `/comment/${comment_id}/delete/`,
                    method: "POST",
                    data: {
                        csrfmiddlewaretoken: csrfToken
                    },
                    success: function(response) {
                        if (response.status == "comment_deleted") {
                            parentCommentDiv.remove();  // Directly remove the parent comment div
                            showToast('Comment was deleted successfully!');
                        } else {
                            showToast('Failed to delete the comment!');
                        }
                    },
                    error: function(error) {
                        console.error("Error deleting the comment:", error);
                    }
                });
            });

            $(document).on("click", ".edit-comment-button", function() {
                const commentId = $(this).data("comment-id");
                const parentCommentDiv = $(this).closest('.comment'); // Navigate to the parent comment div
                const commentContent = parentCommentDiv.find('.comment-content');
                const editForm = parentCommentDiv.find('.edit-comment-form');

                commentContent.hide();
                editForm.show();
            });

            $(document).on("submit", ".edit-comment-form", function(e) {
                e.preventDefault();
                const form = $(this);
                const commentId = form.data("comment-id");
                const parentCommentDiv = form.closest('.comment');
                const commentContent = parentCommentDiv.find('.comment-content');

                $.ajax({
                    url: `/comment/${commentId}/edit/`,
                    method: "POST",
                    data: form.serialize(),
                    success: function(response) {
                        if (response.status === "comment_edited") {
                            commentContent.text(response.text);
                            form.hide();
                            commentContent.show();
                        } else {
                            alert("Failed to edit comment.");
                        }
                    },
                    error: function(error) {
                        console.error("Error editing comment:", error);
                    }
                });
            }); 
            $(document).ready(function() {
                $('.comment').hide();
                $('.comment-section-open').hide();
                $('.comment-section-close').show();
            });
            
                // Toggle the comments list
                $('.toggle-comment-section').click(function() {
                    let commentsList = $(this).closest('.comments-list');
                    let comments = commentsList.find('.comment');
                    
                    if (comments.is(':visible')) {
                        comments.hide();
                        $(this).find('.comment-section-open').hide();
                        $(this).find('.comment-section-close').show();
                    } else {
                        comments.show();
                        $(this).find('.comment-section-open').show();
                        $(this).find('.comment-section-close').hide();
                    }
                });


        });
    </script>
    
</body>
</html>
